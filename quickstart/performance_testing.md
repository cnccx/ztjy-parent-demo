[TOC]

## 前言
在使用spring boot作为首选的开发框架之前，需要知道它的基础性能
- 默认参数下，RestFul的简单并发测试（Api接口只返回hello world），并且对比c++、netty等开发框架
- 找到最佳配置参数
- 数据库（Mysql）简单读写的并发测试
- redis简单读写并发测试
- 简单总结（例如哪里影响了性能）


## 环境配置
### 压测工具wrk
Centos7 编译安装 wrk 压力测试 | 数据D站
机器硬件环境 8核8线程

### 压测目标
ztwl-parent-demo

## 测试结果
### Api返回Hello

| 客户端线程 | 客户端连接数  | 服务端线程  | 服务端最大连接数  | 持续时间  | 服务端内存情况  |  cpu情况 | load  |  qps（query per second） |
| :------------: | :------------: | :------------: | :------------: | :------------: | :------------: | :------------: | :------------: | :------------: |
|  6 |  10000 | 5  | 10000  |  60 | 17  |  500-700+ | 7-  |  7000 |
|  6 |  10000 |  17 | 10000  | 60  | 17  | 500-700+  | 7-9  | 8427  |
|  6 |  10000 |  500 |  10000 | 60  | 18  | 500-700+  | 15+  | 8362  |
|  6 |  10000 |  1000 |  10000 |  60 | 19  |  500-700+ | 15+  | 6321  |

### 简单读写mysql
业务场景，读取数据库的一个简单记录，并且返回

| 客户端线程 | 客户端连接数  | 服务端线程  | 服务端最大连接数  | 持续时间  | 服务端内存情况  |  cpu情况 | load  |  qps（query per second） |
| :------------: | :------------: | :------------: | :------------: | :------------: | :------------: | :------------: | :------------: | :------------: |
|  6 |  10000 | 2  | 10000  |  60 | 17  |  500-700+ | 7-  |  1300 |
|  6 |  10000 | 5  | 10000  |  60 | 17  |  500-700+ | 7-  |  2515 |
|  6 |  10000 | 10  | 10000  |  60 | 17  |  500-700+ | 7-  |  2400 |
|  6 |  10000 |  17 | 10000  | 60  | 17  | 500-700+  | 7-9  | 2311  |
|  6 |  10000 |  默认（200） |  10000 | 60  | 18  | 500-700+  | 15+  | 2400  |

### 简单写入mysql
通过jpa直接写入

| 客户端线程 | 客户端连接数  | 服务端线程  | 服务端最大连接数  | 持续时间  | 服务端内存情况  |  cpu情况 | load  |  qps（query per second） |
| :------------: | :------------: | :------------: | :------------: | :------------: | :------------: | :------------: | :------------: | :------------: |
|  6 |  10000 | 17  | 10000  |  60 | 17  |  500-700+ | 7-  |  950+ |

通过jdbc直接写入

| 客户端线程 | 客户端连接数  | 服务端线程  | 服务端最大连接数  | 持续时间  | 服务端内存情况  |  cpu情况 | load  |  qps（query per second） |
| :------------: | :------------: | :------------: | :------------: | :------------: | :------------: | :------------: | :------------: | :------------: |
|  6 |  10000 | 17  | 10000  |  4 | 17  |  500-700+ | 2  |  950+ |

### 简单读写redis
redisTemplate短连接

| 客户端线程 | 客户端连接数  | 服务端线程  | 服务端最大连接数  | 持续时间  | 服务端内存情况  |  cpu情况 | load  |  qps（query per second） |
| :------------: | :------------: | :------------: | :------------: | :------------: | :------------: | :------------: | :------------: | :------------: |
|  6 |  10000 | 17  | 10000  |  30 | 17  |  500-700+ | 5-7  |  5500+ |

redisTemplate长连接

| 客户端线程 | 客户端连接数  | 服务端线程  | 服务端最大连接数  | 持续时间  | 服务端内存情况  |  cpu情况 | load  |  qps（query per second） |
| :------------: | :------------: | :------------: | :------------: | :------------: | :------------: | :------------: | :------------: | :------------: |
|  6 |  10000 | 17  | 10000  |  30 | 17  |  500-700+ | 5-7  |  7500+ |

使用CacheManager进行缓存（短连接）

| 客户端线程 | 客户端连接数  | 服务端线程  | 服务端最大连接数  | 持续时间  | 服务端内存情况  |  cpu情况 | load  |  qps（query per second） |
| :------------: | :------------: | :------------: | :------------: | :------------: | :------------: | :------------: | :------------: | :------------: |
|  6 |  10000 | 17  | 10000  |  30 | 17  |  500-700+ | 5-7  |  3500+ |

使用CacheManager进行缓存（长连接）

| 客户端线程 | 客户端连接数  | 服务端线程  | 服务端最大连接数  | 持续时间  | 服务端内存情况  |  cpu情况 | load  |  qps（query per second） |
| :------------: | :------------: | :------------: | :------------: | :------------: | :------------: | :------------: | :------------: | :------------: |
|  6 |  10000 | 17  | 10000  |  30 | 17  |  500-700+ | 5-7  |  4300+ |

简单总结：使用CacheManager之后，发现性能降低，`暂时没有找到理由`


### redis单独测试（redisTemplate）

| 读写条数  | max-active  | 时间  |
| :------------: | :------------: | :------------: |
| 10w  |  17 |  5s-10s |
| 10w  | 25  | 5s-10s  |
| 10w  | 100  |  5s-10s |

## 总结
- 服务端线程数（max-threads）设置过大（100+）会导致load增高，但是qps不增高，推荐在17左右，可适量增加
- 服务端最大连接数（max-conntion）使用默认设置（10000）即可
- redis最大连接数默认是8，设置为17-25表现已经到达最高
- CacheManager使用之后性能降低

注：测试环境下redis存储数据结构简单，仅供参考


